<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    
    <h:head>
        <title>Envio de Arquivos</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />     
    </h:head>
    <h:body class="divMenu">
        <div style="z-index: 15; position: absolute; top: 100px; ">
            <h:form id="form_enviar_arquivo">   
                    <br /><br />
                    <div class="divMae divFundo" style="width: 1180px" align="left">                        
                        <h:outputLabel value="Assunto: " styleClass="fontePadrao" for="idAssunto"/>
                        <h:inputText id="idAssunto" value="#{enviarArquivosBean.mensagem.assunto}" size="60"/>
                        <a4j:commandLink styleClass="idSalvar iLink" value="Anexos" title="Ver arquivos anexados" style="width: 100px;" oncomplete="#{rich:component('form_enviar_arquivo:i_painel_anexo')}.show(); return false;"  render="idQuantidadeAnexo, id_panel_grid_anexos"/>
                        <h:outputText id="idQuantidadeAnexo" value="#{enviarArquivosBean.quantidadeAnexo} Anexo (s)" />
                        <br /><br />
                        <h:outputLabel value="FILTRAR: " styleClass="fontePadraoNegrito"/>
                        <h:panelGrid columns="3" id="idPainel" styleClass="margin-top-maior">
                            <h:column>
                                <div style="overflow-x:auto; height: 100px; width: 150px; margin-right: 20px;">
                                    <rich:dataTable value="#{enviarArquivosBean.listaConvencaoObject}"  var="linha" style="width:100%" iterationStatusVar="itConvencao" id="tblConvencao">
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:selectBooleanCheckbox value="#{enviarArquivosBean.marcarTodosConvencao}">
                                                    <a4j:ajax event="change" listener="#{enviarArquivosBean.ckeckTodasConvencoes()}" render="tblConvencao tblGrupoCidade tblCnaeConvencao tblContribuinte"/>
                                                </h:selectBooleanCheckbox>
                                            </f:facet>
                                            <h:selectBooleanCheckbox value="#{linha.argumento0}" id="idCheckCon#{linha.argumento1.id}">
                                                <a4j:ajax event="change" render="idCheckCon#{linha.argumento1.id} tblGrupoCidade tblCnaeConvencao tblContribuinte" listener=""/>
                                            </h:selectBooleanCheckbox>
                                        </rich:column>
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:outputText value="Convenção"/>
                                            </f:facet>
                                            <h:outputText value="#{linha.argumento1.descricao}"/>
                                        </rich:column>
                                    </rich:dataTable>
                                </div>
                            </h:column>
                            <h:column>
                                <div style="overflow-x:auto; height: 100px; width: 150px; margin-right: 20px;">
                                    <rich:dataTable value="#{enviarArquivosBean.listaGrupoCidadeConvencaoObject}" var="linha" style="width:100%" iterationStatusVar="itGrupoCidade" id="tblGrupoCidade">
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:selectBooleanCheckbox value="#{enviarArquivosBean.marcarTodosGrupoCidade}">
                                                    <a4j:ajax event="change" listener="#{enviarArquivosBean.ckeckTodasGrupoCidade()}" render="tblGrupoCidade tblContribuinte"/>
                                                </h:selectBooleanCheckbox>
                                            </f:facet>
                                            <h:selectBooleanCheckbox value="#{linha.argumento0}" id="idCheckGC#{linha.argumento1.id}">
                                                <a4j:ajax event="change" listener="#{enviarArquivosBean.marcarGrupoCidade(itGrupoCidade.index) }" render="idCheckGC#{linha.argumento1.id} tblGrupoCidade tblContribuinte"/>
                                            </h:selectBooleanCheckbox>
                                        </rich:column>
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:outputText value="Grupo Cidade"/>
                                            </f:facet>
                                            <h:outputText value="#{linha.argumento1.descricao}"/>
                                        </rich:column>
                                    </rich:dataTable>
                                </div>
                            </h:column>
                            <h:column>
                                <div style="overflow-x:auto; height: 100px; width: 450px; margin-right: 20px;">
                                    <rich:dataTable value="#{enviarArquivosBean.listaCnaeObject}" var="linha" style="width:100%" iterationStatusVar="itConvencao" id="tblCnaeConvencao">
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:selectBooleanCheckbox value="#{enviarArquivosBean.marcarTodosCnaeConvencao}">
                                                    <a4j:ajax event="change" listener="#{enviarArquivosBean.ckeckTodasCnaeConvencao()}" render="tblCnaeConvencao tblContribuinte"/>
                                                </h:selectBooleanCheckbox>
                                            </f:facet>
                                            <h:selectBooleanCheckbox value="#{linha.argumento0}" id="idCheckCna#{linha.argumento1.id}">
                                                <a4j:ajax event="change" listener="#{enviarArquivosBean.marcarCnaeConvencao(itConvencao.index)}" render="idCheckCna#{linha.argumento1.id} tblContribuinte"/>
                                            </h:selectBooleanCheckbox>
                                        </rich:column>
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:outputText value="Cnae Convenção"/>
                                            </f:facet>
                                            <h:outputText value="#{linha.argumento1.cnae} - #{linha.argumento1.numero}"/>
                                        </rich:column>
                                    </rich:dataTable>
                                </div>
                            </h:column>
                        </h:panelGrid>                        
                        <br /><br />
                        <div class="divMae divFundo bg-white" style="overflow:auto; height:300px; margin: auto 0;">
                            <h:outputLabel value="Destinatario (s): " styleClass="fontePadrao"/>
                            <br />
                            <rich:panel styleClass="no-border no-margin">
                                <rich:dataTable value="#{enviarArquivosBean.listaContribuinte}" var="linha" iterationStatusVar="it" id="tblContribuinte">
                                    <rich:column style="text-align: center;">
                                        <f:facet name="header">
                                            <h:outputText value="#" />
                                        </f:facet>
                                        <h:outputText value="#{it.index}"/>
                                    </rich:column>                                    
                                    
                                    <rich:column styleClass="coluna">
                                        <f:facet name="header">
                                            <h:selectBooleanCheckbox value="#{enviarArquivosBean.chkMarcaTodos}">
                                                <a4j:ajax event="change" listener="#{enviarArquivosBean.marcaTodos}" render="tblContribuinte" />
                                            </h:selectBooleanCheckbox>
                                        </f:facet>
                                        <h:selectBooleanCheckbox value="#{linha.argumento0}" id="idCheckContribuinte1#{linha.argumento1.id}">
                                            <a4j:ajax event="change" render="idCheckContribuinte1#{linha.argumento1.id}" />
                                        </h:selectBooleanCheckbox>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="Documento - Nome"/>
                                        </f:facet>
                                        <h:outputText value="#{linha.argumento2}"/>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="Telefone"/>
                                        </f:facet>
                                        <h:outputText value="#{linha.argumento3}"/>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="E-mail"/> 
                                        </f:facet>
                                        <h:outputText value="#{linha.argumento4}"/>
                                    </rich:column>
                                </rich:dataTable>
                            </rich:panel> 
                        </div>
                        <br /><br />
                        <div class="divMae divFundo bg-white" style="overflow:auto; height:300px; margin: auto 0;">
                            <h:outputLabel value="Mensagem: " styleClass="fontePadrao"/><br /><br />
                            <rich:editor value="#{enviarArquivosBean.mensagem.mensagem}"></rich:editor>
                        </div>
                        <div class="clear"></div>
                        <br /><br />
                        <a4j:commandLink styleClass="idNovo iLink" style="width: 150px;" value="Enviar E-mails" action="#{enviarArquivosBean.enviarArquivos}" oncomplete="#{rich:component('form_enviar_arquivo:i_painel_mensagem')}.show(); return false;"  render="i_painel_mensagem" status="i_status"/>
                        <a4j:commandLink styleClass="idNovo iLink" style="width: 150px;" value="Novo" action="#{enviarArquivosBean.novo('enviarArquivosContribuinte')}" />
                    </div>               
                <br />
                <!-- 
                <div id="boxes">
                    <div id="divSalvar" class="window" style="width: 600px; height: 500px;">
                        <a4j:commandLink styleClass="close closeModal" title="Fechar">
                            <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                        </a4j:commandLink>
                        <br />
                        <center>
                            <label for="idUpload" style="cursor: pointer; float: right">
                                <div class="idNovo iLink" style="width: 200px;">
                                    Enviar arquivo 
                                </div>
                            </label>                            
                            <h:panelGrid columns="2">
                                <h:outputText value="Arquivos Anexados" styleClass="fontePadrao"/>
                                <br /><br />
                                <rich:dataTable value="# {enviarArquivosBean.listaArquivosContribuinte}" var="linha" iterationStatusVar="it" id="idArquivos">
                                     <rich:column style="text-align: center;">
                                         <f:facet name="header">
                                             <h:outputText value="#" />
                                         </f:facet>
                                         <h:outputText value="# {it.index}"/>
                                     </rich:column>

                                     <rich:column styleClass="coluna">
                                         <f:facet name="header">
                                             <h:outputText value="Excluir"/>
                                         </f:facet>
                                         <a4j:commandButton image="/Imagens/excluirp.png" disabled="# {controleAcessoBean.botaoExcluir}">
                                             <a4j:ajax event="click" listener="# {enviarArquivosBean.excluirArquivosContribuinte(it.index)}" render="idArquivos idQuantidadeAnexo" />
                                         </a4j:commandButton>
                                     </rich:column>

                                     <rich:column>
                                         <f:facet name="header">
                                             <h:outputText value="Nome do Anexo"/>
                                         </f:facet>
                                         <h:outputText value="# {linha.argumento1}"/>
                                     </rich:column>
                                </rich:dataTable>                                 
                            </h:panelGrid>
                        </center>
                        <br />
                    </div>
                    <div id="mask"></div>
                </div> -->
                <rich:popupPanel id="i_painel_anexo" modal="true" resizeable="true" domElementAttachment="form" width="500" header="Arquivos anexados" height="300">
                    <f:facet name="controls">
                        <h:outputLink onclick="#{rich:component('i_painel_anexo')}.hide(); return false;">                            
                            <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                        </h:outputLink>
                    </f:facet>
                    <label for="idUpload" style="cursor: pointer;">
                        <div class="idNovo iLink" style="width: 200px;">
                            Enviar arquivo 
                        </div>
                    </label>
                    <rich:panel styleClass="clear no-border"></rich:panel>
                    <h:panelGrid columns="2" id="id_panel_grid_anexos">
                        <h:outputText value="Arquivos Anexados" styleClass="fontePadrao"/>
                        <br /><br />
                        <rich:dataTable value="#{enviarArquivosBean.listaArquivosContribuinte}" var="linha" iterationStatusVar="it" id="idArquivoss">
                             <rich:column styleClass="coluna">
                                 <f:facet name="header">
                                     <h:outputText value="Excluir"/>
                                 </f:facet>
                                 <a4j:commandButton image="/Imagens/excluirp.png" disabled="#{controleAcessoBean.botaoExcluir}">
                                     <a4j:ajax event="click" listener="#{enviarArquivosBean.excluirArquivosContribuinte(it.index)}" render="idArquivoss idQuantidadeAnexo" />
                                 </a4j:commandButton>
                             </rich:column>

                             <rich:column>
                                 <f:facet name="header">
                                     <h:outputText value="Nome do Anexo"/>
                                 </f:facet>
                                 <h:outputText value="#{linha.argumento1}"/>
                             </rich:column>
                        </rich:dataTable>                                 
                    </h:panelGrid>                    
                </rich:popupPanel>
                <rich:popupPanel id="i_painel_mensagem" modal="true" resizeable="true">
                    <f:facet name="header">
                        <h:outputText value="Mensagem"/>
                    </f:facet>
                    <f:facet name="controls">
                        <h:outputLink value="#" onclick="#{rich:component('i_painel_mensagem')}.hide(); return false;">                            
                        </h:outputLink>
                    </f:facet>
                    <center>
                        <h:outputText value="#{enviarArquivosBean.msgConfirma}" styleClass="fontePadrao"/>                            
                        <br /><br />
                        <a4j:commandButton value="Ok" title="Ok" oncomplete="#{rich:component('form_enviar_arquivo:i_painel_mensagem')}.hide();" action="enviarArquivosContribuinte" />
                    </center>
                </rich:popupPanel>                  
            </h:form>
        </div>        
        <f:subview id="header">
            <ui:include src="templates/template.xhtml"/>
            <ui:include src="templates/templateLinks.xhtml"/>
        </f:subview>
        <f:view>
            <c:set scope="request" var="object" value="${enviarArquivosBean.mensagem}"/>
            <h:form>
                <center>
                    <div class="headerPanel">
                        <h:outputText value="Envio de Arquivos Contribuinte" styleClass="fontePanel" style="width: 100%;"/>
                    </div>                  
                </center>
            </h:form>
            <form action="servletEnvioArquivoContribuinte" name="formEnvioArquivo" enctype="multipart/form-data" accept-charset="ISO-8859-1" method="post">  
                <input id="idUpload" type="file" name="nArquivo" onchange="submit();" style="visibility: hidden" accesskey="u"/>
            </form>            
        </f:view>
    </h:body>
</ui:composition>