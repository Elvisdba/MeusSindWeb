<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <h:head>
        <title>Baixa Boleto</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
    </h:head>
    <h:body class="divMenu">
        <f:subview id="header">
            <ui:include src="template.xhtml"/>
            <ui:include src="templateLinks.xhtml"/>
        </f:subview>
        <f:view>
            <h:form id="formBaixaBoleto">

                <center>
                    <div class="headerPanel">
                        <h:outputText value="Baixa Boleto" styleClass="fontePanel" style="width: 100%;"/>
                    </div>
                </center>
                <div class="divMae">
                    <div class="fontePadrao divFundo">
                        <h:panelGrid columns="4">
                            <h:commandButton image="/Imagens/pesquisar.png" action="#{chamadaPaginaBean.pesquisaPessoaJuridica}"/>
                            <h:outputLabel value="Empresa: " styleClass="fontePadrao"/>
                            <h:outputLabel id="idNome" value="#{baixaBoletoBean.pessoa.documento} - #{baixaBoletoBean.pessoa.nome}" styleClass="fontePadraoNegrito"/>
                        </h:panelGrid>
                        
                        <h:panelGrid columns="6">
                            <h:outputText value="Contribuição: " styleClass="fontePadrao" rendered="false"/>
                            <h:selectOneMenu style="margin-right: 15px;" value="#{baixaBoletoBean.idServicos}" rendered="false">
                                <a4j:ajax event="change" render="this"/>
                                <f:selectItems value="#{baixaBoletoBean.listaServicoCobranca}"/>
                            </h:selectOneMenu>
                            
                            <h:outputLabel value="Número do Boleto: " styleClass="fontePadrao"/>
                            <h:inputText value="#{baixaBoletoBean.numBoleto}" size="15" maxlength="100" >
                                <a4j:ajax event="blur" listener="#{baixaBoletoBean.refreshPessoa}" render="idNumBoleto"/>
                            </h:inputText>
                                
                            <h:commandLink value="Pesquisar" styleClass="idPesquisar iLink" action="#{baixaBoletoBean.pesquisarBoleto}"/>
                            <h:outputText id="outConfirmaTela" value="#{baixaBoletoBean.msgConfirma}" styleClass="corErro" style="margin-left: 20px; font-size: 15pt"/>
                        </h:panelGrid>
                        
                        <h:panelGrid>
                            <h:selectOneRadio value="#{baixaBoletoBean.caixaBanco}" styleClass="fontePadrao" onchange="submit();">
                                <f:selectItem itemValue="caixa" itemLabel="Caixa"/>
                                <f:selectItem itemValue="banco" itemLabel="Banco"/>

                            </h:selectOneRadio>
                        </h:panelGrid>
                        
                        <h:panelGroup style="overflow:auto; margin-top: 20px;" layout="block">
                            <div class="fontePadrao divFundo" style="background: white;">
                                <rich:dataTable value="#{baixaBoletoBean.listaBoletos}" var="linha" style="width:100%" id="tbl" iterationStatusVar="it">
                                    <rich:column styleClass="coluna">
                                        <f:facet name="header"><h:outputText value="#"/></f:facet>
                                        <h:outputText value="#{it.index}"/>
                                    </rich:column> 
                                    
                                    <rich:column styleClass="coluna">
                                        <f:facet name="header">
                                            <h:selectBooleanCheckbox value="#{baixaBoletoBean.marcarTodos}">
                                                <a4j:ajax event="change" render="tbl" listener="#{baixaBoletoBean.marcar()}"/>                                            
                                            </h:selectBooleanCheckbox>
                                        </f:facet>
                                        <!-- <h:column rendered="# {baixaBoletoBean.caixaBanco == 'caixa'}">
                                            <h:selectBooleanCheckbox value="# {linha.argumento8}">
                                                <a4j:ajax event="change" render="this" />
                                            </h:selectBooleanCheckbox>
                                        </h:column> -->

                                        <h:column rendered="#{baixaBoletoBean.caixaBanco == 'caixa'}">
                                            <div style="width: 80px">
                                                <a4j:commandLink value="( Baixar )" action="#{baixaBoletoBean.baixarBoletos}" styleClass="#{linha.argumento0}" render="tbl outConfirma outConfirmaTela">
                                                    <a4j:param value="#{it.index}" assignTo="#{baixaBoletoBean.index}"/>
                                                </a4j:commandLink>
                                            </div>
                                        </h:column>
                                        
                                        <h:column rendered="#{baixaBoletoBean.caixaBanco == 'banco'}">
                                            <div style="width: 80px">
                                                <a4j:commandLink value="( Baixar )" action="#{baixaBoletoBean.baixarBoletos}" styleClass="#{linha.argumento0}" render="tbl outConfirma outConfirmaTela">
                                                    <a4j:param value="#{it.index}" assignTo="#{baixaBoletoBean.index}"/>
                                                </a4j:commandLink>
                                            </div>
                                        </h:column>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="ID"/></f:facet>
                                        <h:outputText value="#{linha.argumento1.id}"/>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Boleto"/></f:facet>
                                        <h:outputText value="#{linha.argumento1.documento}"/>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Contribuinção - Tipo"/></f:facet>
                                        <div style="width: 150px">
                                            <h:outputText value="#{linha.argumento1.servicos.descricao} - #{linha.argumento1.tipoServico.descricao}"/>
                                        </div>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Referência"/></f:facet>
                                        <h:outputText value="#{linha.argumento1.referencia}"/>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Vencimento"/></f:facet>
                                        <h:outputText value="#{linha.argumento1.vencimento}"/>
                                    </rich:column>

                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Valor"/></f:facet>
                                        <h:inputText maxlength="20" size="8" value="#{linha.argumento2}">
                                            <a4j:ajax event="blur" listener="#{baixaBoletoBean.atualizaValoresGrid(it.index)}" render="i_valor_pago"/>
                                        </h:inputText>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Multa"/></f:facet>
                                        <h:inputText id="i_multa" maxlength="20" size="8" value="#{linha.argumento3}">
                                            <a4j:ajax event="blur" listener="#{baixaBoletoBean.atualizaValoresGrid(it.index)}" render="i_valor_pago"/>
                                        </h:inputText>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Juros"/></f:facet>
                                        <h:inputText maxlength="20" size="8" value="#{linha.argumento4}">
                                            <a4j:ajax event="blur" listener="#{baixaBoletoBean.atualizaValoresGrid(it.index)}" render="i_valor_pago"/>
                                        </h:inputText>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Correção"/></f:facet>
                                        <h:inputText maxlength="10" size="8" value="#{linha.argumento5}">
                                            <a4j:ajax event="blur" listener="#{baixaBoletoBean.atualizaValoresGrid(it.index)}" render="i_valor_pago"/>
                                        </h:inputText>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Desconto"/></f:facet>
                                        <h:inputText maxlength="10" size="8" value="#{linha.argumento6}">
                                            <a4j:ajax event="blur" listener="#{baixaBoletoBean.atualizaValoresGrid(it.index)}" render="i_valor_pago"/>
                                        </h:inputText>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header"><h:outputText value="Valor Pago"/></f:facet>
                                        <h:inputText id="i_valor_pago" size="8" readonly="true" styleClass="fontePadraoNegrito" value="#{linha.argumento7}"/>
                                    </rich:column>
                                </rich:dataTable>
                            </div>
                        </h:panelGroup>
                    </div>
                    <div style="clear: both;"></div>
                    <div style="float: left; margin-top: 15px;">
                        <a4j:commandLink styleClass="idNovo iLink" value="Baixar Boleto" title="Baixar Boleto" oncomplete="modalMensagem()" id="i_btn"
                                         action="#{baixaBoletoBean.baixarBoletos}" render="tbl outConfirma outConfirmaTela" style="width: 150px;" rendered="#{!baixaBoletoBean.disBtnBaixar}"/>
                    </div>
                </div>
                <div id="boxes">
                    <div id="divMensagem" class="window">
                        <a4j:commandLink styleClass="close closeModal" title="Fechar">
                            <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                        </a4j:commandLink>
                        <br />
                        <center>
                            <h:outputText id="outConfirma" value="#{baixaBoletoBean.msgConfirma}" styleClass="fontePadrao"/>
                            <br /><br />
                            <h:commandLink styleClass="idNovo iLink closeModal" value="OK" title="OK"/>
                        </center>
                    </div>
                    <div id="mask"></div>
                </div>
            </h:form>
        </f:view>
    </h:body>
</ui:composition>
