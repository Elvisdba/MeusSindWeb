<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Sindical - Movimentos a Receber</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important;} 
            .ui-button { padding: 3px!important; }

            .ui-datatable tr.ui-datatable-even:hover, .ui-datatable tr.ui-datatable-odd:hover {
                background: #ECF3FE;
            }
            .tblListaBoleto{
                background-color: #39ff9c!important;
                //color: #CCFF66!important;
            }
        </style>

        <script type="text/javascript">
            // BLOQUEIA ENTER
            // DESABILITA ENTER
            // DISABLED ENTER
            // VERIFICA SE OQ ESTOU DIGITANDO É STRING
//            function stopRKey(evt) {
//                var evt = (evt) ? evt : ((event) ? event : null);
//                //var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
//                if (evt.keyCode === 13) {
//                    return false;
//                }
//            }
//
//            document.onkeypress = stopRKey;
        </script>
    </h:head>
    <h:body>
        <!-- INICIA DIV wrap e main -->
        <div id="wrapx">
            <div id="mainx">
                <!-- INICIA DIV wrap e main -->  
                <f:subview id="header">
                    <ui:include src="templates/templatePrime.xhtml"/>
                    <ui:include src="templates/templateAcessoFilial.xhtml"/>
                </f:subview>
                <f:view>
                    <!-- <p:panel style="border: 0px; width: 1200px; margin: 0 auto"> novo tamanho-->
                    <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                        <h:outputText value="Movimentos a Receber" styleClass="fonteHeader" />
                        <h:form id="formMovimentosReceberPesquisa">
                            <h:panelGrid columns="3" style="clear: both; float: right">
                                <p:column>
                                    <p:outputLabel value="Pesquisa por Boleto" style="font-size: 10pt!important; font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <p:selectOneMenu value="#{movimentosReceberSocialBean.indexConta}" style="width: 300px">
                                        <p:ajax event="change" global="false" update=":formMovimentosReceber"/>
                                        <f:selectItems value="#{movimentosReceberSocialBean.listaContas}" />
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column>
                                    <p:inputText placeholder="Número do Boleto" value="#{movimentosReceberSocialBean.descPesquisaBoleto}" size="20">
                                        <p:ajax event="blur" update="@this" global="false"/>
                                    </p:inputText>

                                    <p:commandButton icon="ui-icon-search" action="#{movimentosReceberSocialBean.pesquisaBoleto()}" update=":formMovimentosReceber" title="Pesquisar pelo número do Boleto"/>
                                </p:column>
                            </h:panelGrid>
                        </h:form>

                        <h:form id="formMovimentosReceber">
                            <p:panel styleClass="fundoCinza" style="clear: both">
                                <h:panelGrid columns="3" style="width: 100%">
                                    <p:column>
                                        <p:commandButton value="Adicionar uma Pessoa" action="#{chamadaPaginaBean.pesquisaPessoa}" rendered="#{movimentosReceberSocialBean.pessoa.id == -1}"/>
                                        <p:commandButton value="Pesquisar outra Pessoa" action="#{chamadaPaginaBean.pesquisaPessoa}" rendered="#{movimentosReceberSocialBean.pessoa.id != -1}"/>
                                        <h:outputText value="#{movimentosReceberSocialBean.pessoa.nome}" title="#{movimentosReceberSocialBean.pessoa.nome}" style="margin-left: 20px; font-weight: bold"/>
                                    </p:column>

                                    <p:column>
                                        <p:commandButton ajax="false" action="#{chamadaPaginaBean.pesquisaPessoa()}" actionListener="#{movimentosReceberSocialBean.adicionarPesquisa()}" value="Adicionar mais Pessoas" rendered="#{movimentosReceberSocialBean.listaPessoa.size() > 0}" style="margin-left: 10px; cursor: pointer; float: right" /> 
                                    </p:column>
                                </h:panelGrid>

                                <h:panelGrid style="clear: both;" rendered="#{movimentosReceberSocialBean.listaPessoa.size() > 1}">
                                    <p:dataGrid value="#{movimentosReceberSocialBean.listaPessoa}" var="linha" id="tbl_list" rowIndexVar="index">
                                        <h:outputLabel value="#{linha.nome}" rendered="#{index != 0}" />
                                        <p:commandButton icon="ui-icon-trash" action="#{movimentosReceberSocialBean.removerPessoaLista(index)}" rendered="#{index != 0}" update=":formMovimentosReceber" title="Clique para remover #{linha.nome} da Lista"/>
                                    </p:dataGrid>
                                </h:panelGrid>
                            </p:panel>

                            <h:panelGrid style="float: left; clear: both; margin-top: 10px; margin-bottom: 10px" columns="9" id="i_panel" rendered="#{movimentosReceberSocialBean.listaMovimento.size() > 0 or movimentosReceberSocialBean.pessoa.id != -1}">
                                <p:column>
                                    <h:outputText value="Filtrar por" /><br />
                                    <p:selectOneMenu value="#{movimentosReceberSocialBean.porPesquisa}" style="padding-right: 10px; margin-right: 20px">
                                        <p:ajax event="change" update="@this formMovimentosReceber" listener="#{movimentosReceberSocialBean.atualizarStatus}"/>
                                        <f:selectItem itemValue="todos"    itemLabel="Todos"/>
                                        <f:selectItem itemValue="abertos"  itemLabel="Abertos"/>
                                        <f:selectItem itemValue="quitados" itemLabel="Quitados"/>
                                    </p:selectOneMenu>
                                </p:column>

                                <p:column>
                                    <h:outputText value="Total em Aberto" /><br />
                                    <p:inputText readonly="true" size="10" value="#{movimentosReceberSocialBean.total}" style="font-weight: bold; margin-right: 20px; text-align: right"/>
                                </p:column>

                                <p:column>
                                    <h:outputText value="Acréscimo" /><br />
                                    <p:inputText readonly="true" size="10" value="#{movimentosReceberSocialBean.acrescimo}" style="font-weight: bold; margin-right: 20px; text-align: right"/>
                                </p:column>

                                <p:column>
                                    <h:outputText value="Desconto"/><br />
                                    <p:inputText id="i_desconto" size="10" value="#{movimentosReceberSocialBean.desconto}" style="margin-right: 20px; text-align: right">
                                        <p:ajax event="blur" update="@this i_panel tbl" listener="#{movimentosReceberSocialBean.calculoDesconto()}" />
                                    </p:inputText>
                                </p:column>

                                <p:column>
                                    <h:outputText value="Total Calculado em Aberto"/><br />
                                    <p:inputText readonly="true" value="#{movimentosReceberSocialBean.totalCalculado}" style="font-weight: bold; margin-right: 20px; text-align: right" />
                                </p:column>

                                <p:column>
                                    <br />
                                    <p:commandButton value="Baixar" action="#{movimentosReceberSocialBean.caixaOuBanco}" title="Baixar este Movimento" rendered="#{movimentosReceberSocialBean.porPesquisa != 'quitados'}" />
                                </p:column>

                                <p:column>
                                    <br />
                                    <p:commandButton value="Acordo" title="Fazer um acordo" action="#{movimentosReceberSocialBean.telaAcordo()}" rendered="#{movimentosReceberSocialBean.porPesquisa != 'quitados'}" />
                                </p:column>

                                <p:column>
                                    <br />
                                    <p:commandButton value="Estornar" title="Estornar Movimentos Baixados" onclick="PF('i_dlg_estorno').show()" rendered="#{movimentosReceberSocialBean.porPesquisa != 'abertos'}" disabled="#{controleAcessoBean.botaoEstornarMensalidades}"/>
                                </p:column>
                                
                                <p:column>
                                    <br />
                                    <p:commandButton value="Deletar" title="Deletar Movimentos Selecionados" onclick="PF('i_dlg_excluir').show()" rendered="#{movimentosReceberSocialBean.porPesquisa != 'quitados'}" disabled="#{controleAcessoBean.botaoExcluir}"/>
                                </p:column>

                                <p:column>
                                    <br />
                                    <p:commandButton value="Mesclar" title="Mesclar Movimentos" action="#{movimentosReceberSocialBean.mesclar()}" rendered="#{movimentosReceberSocialBean.porPesquisa != 'abertos'}" />
                                </p:column>
                            </h:panelGrid>

                            <h:panelGrid style="clear: both; width: 100%">
                                <p:messages id="i_msg" showDetail="true" closable="true" />  
                            </h:panelGrid>

                            <p:dataTable value="#{movimentosReceberSocialBean.listaMovimento}" var="linha" style="clear: both; font-size: 8pt!important" id="tbl" paginator="true" rows="20" emptyMessage="Nenhuma pendência foi encontrada!" rowStyleClass="#{linha.argumento28}">
                                <f:facet name="header">
                                    <p:commandButton id="toggler" type="button" value="Colunas" style="float:right" icon="ui-icon-calculator" />
                                    <p:columnToggler datasource="tbl" trigger="toggler" />
                                </f:facet>

                                <p:column style="text-align: center; width: 15px">
                                    <p:selectBooleanCheckbox value="#{linha.argumento0}" disabled="#{linha.argumento25}">
                                        <p:ajax event="change" update="tbl :formMovimentosReceber:i_panel" listener="#{movimentosReceberSocialBean.calculoDesconto()}" />
                                    </p:selectBooleanCheckbox>
                                </p:column>

                                <p:column headerText="Beneficiário" rendered="#{movimentosReceberSocialBean.listaPessoa.size() eq 1 and !movimentosReceberSocialBean.pessoaJuridicaNaLista}">
                                    <p:commandLink value="#{linha.argumento14}" action="#{movimentosReceberSocialBean.complementoPessoa(linha)}" onclick="PF('i_dlg_dados').show()" update=":formMovimentosReceber:i_dados" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column headerText="Titular" rendered="#{movimentosReceberSocialBean.listaPessoa.size() gt 1 and !movimentosReceberSocialBean.pessoaJuridicaNaLista}">
                                    <p:commandLink value="#{linha.argumento13}" action="#{movimentosReceberSocialBean.complementoPessoa(linha)}" onclick="PF('i_dlg_dados').show()" update=":formMovimentosReceber:i_dados" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column headerText="Titular" rendered="#{movimentosReceberSocialBean.listaPessoa.size() ge 1 and movimentosReceberSocialBean.pessoaJuridicaNaLista}">
                                    <p:commandLink value="#{linha.argumento14}" action="#{movimentosReceberSocialBean.complementoPessoa(linha)}" onclick="PF('i_dlg_dados').show()" update=":formMovimentosReceber:i_dados" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column headerText="Serviços">
                                    <h:outputText value="#{linha.argumento2}" style="font-size: 8pt!important"/>
                                </p:column>
                                
                                <p:column headerText="Tipo" style="text-align: center">
                                    <h:outputText value="#{linha.argumento3}" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column style="text-align: center; width: 75px" headerText="Vencimento">
                                    <h:outputText value="#{linha.argumento5}" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column headerText="Valor Base" style="width: 80px">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento6}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column headerText="Acréscimo" style="width: 80px">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento7}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column headerText="Desconto" style="width: 70px">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento8}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column headerText="Vl. Calculado" style="width: 80px">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento9}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column style="text-align: center; width: 70px" headerText="Baixa" rendered="#{movimentosReceberSocialBean.porPesquisa != 'abertos'}">
                                    <h:outputText value="#{linha.argumento10}" style="font-size: 8pt!important;"/>
                                </p:column>

                                <p:column headerText="Valor Pago" style="width: 80px" rendered="#{movimentosReceberSocialBean.porPesquisa != 'abertos'}">
                                    <h:outputText value="R$ "/>
                                    <h:outputText value="#{linha.argumento11}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column style="text-align: center; width: 20px" headerText="E/S">
                                    <h:outputText value="#{linha.argumento12}" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column style="text-align: center; width: 50px" headerText="Mais">
                                    <p:commandLink ajax="false" value="Alterar" action="#{movimentosReceberSocialBean.telaMovimento(linha.argumento1)}" disabled="#{controleAcessoBean.botaoAlterarMovimento}"/>
                                </p:column>

                                <p:column style="text-align: center; width: 30px" headerText="Recibo" rendered="#{movimentosReceberSocialBean.porPesquisa != 'abertos'}">
                                    <h:commandLink target="_blank" action="#{movimentosReceberSocialBean.recibo(linha.argumento1)}" rendered="#{!empty(linha.argumento10)}" title="Imprimir este Recibo">
                                        <p:commandButton icon="ui-icon-print"  title="Imprimir este Recibo"/>
                                    </h:commandLink>
                                </p:column>

                                <p:column style="text-align: center; width: 30px" headerText="Enc.">
                                    <h:commandLink target="_blank" action="#{movimentosReceberSocialBean.encaminhamento(linha.argumento27)}" rendered="#{movimentosReceberSocialBean.pesquisaGuia(linha.argumento27).encaminhamento == true}" title="Imprimir este Encaminhamento">
                                        <p:commandButton icon="ui-icon-print"  title="Imprimir este Encaminhamento"/>
                                    </h:commandLink>
                                </p:column>
                            </p:dataTable>      

                            <p:dialog widgetVar="dlg_caixa_banco" header="Baixa de Boletos" resizable="false" width="400" modal="true">
                                <h:panelGrid columns="3" style="margin: 0 auto; ">
                                    <p:commandButton value="CAIXA" action="#{movimentosReceberSocialBean.telaBaixa('caixa')}" />  
                                    <p:outputLabel value="ou" />
                                    <p:commandButton value="BANCO" action="#{movimentosReceberSocialBean.telaBaixa('banco')}" />       
                                </h:panelGrid>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_estorno" header="Deseja estornar este Movimento" resizable="false" width="400" modal="true">
                                <p:commandButton value="Sim"      type="submit" styleClass="ui-confirmdialog-yes" action="#{movimentosReceberSocialBean.estornarBaixa()}" update="formMovimentosReceber" onclick="PF('i_dlg_estorno').hide()" style="clear: both; float: left" icon="ui-icon-check"/>  
                                <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" onclick="PF('i_dlg_estorno').hide()" style="float: left" icon="ui-icon-close"/>       
                            </p:dialog>
                            
                            <p:dialog widgetVar="i_dlg_excluir" header="Deseja excluir estes Movimentos" resizable="false" width="400" modal="true">
                                <h:panelGrid>
                                    <p:outputLabel value="Deseja realmente EXCLUIR esse movimento?" style="font-size: 11pt!important"/>
                                </h:panelGrid>
                                
                                <h:panelGrid style="width: 100%">
                                    <p:outputLabel value="Digite um motivo para exclusão" style="font-size: 10pt!important; font-weight: bold"/>
                                    <p:inputTextarea value="#{movimentosReceberSocialBean.motivoInativacao}" style="width: 100%"/>
                                </h:panelGrid>
                                
                                <p:commandButton value="Sim"      type="submit" styleClass="ui-confirmdialog-yes" action="#{movimentosReceberSocialBean.inativarMovimentos()}" update="formMovimentosReceber" onclick="PF('i_dlg_estorno').hide()" style="clear: both; float: left" icon="ui-icon-check"/>  
                                <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" onclick="PF('i_dlg_excluir').hide()" style="float: left" icon="ui-icon-close"/>       
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_mesclar" header="Selecione os Boletos a serem mesclados" resizable="false" width="600" modal="true">
                                <p:outputPanel id="customPanel" style="margin-bottom:10px">
                                    <p:selectOneRadio id="customRadio" layout="custom" value="#{movimentosReceberSocialBean.boletoSelecionadoMesclar}">
                                        <f:selectItems value="#{movimentosReceberSocialBean.listaMesclar}"/>
                                    </p:selectOneRadio>

                                    <h:panelGrid columns="1" cellpadding="5">
                                        <c:forEach items="#{movimentosReceberSocialBean.listaMesclar}" var="linha">
                                            <h:panelGrid columns="2">
                                                <h:column>
                                                    <p:radioButton id="opt#{linha.argumento0}" for="customRadio" itemIndex="#{linha.argumento0}" />
                                                </h:column>

                                                <h:column>
                                                    <h:outputLabel for="opt#{linha.argumento0}" value="#{linha.argumento1}" />
                                                </h:column>
                                            </h:panelGrid>                                        
                                            <p:outputLabel value="123456#{linha.argumento1}" />
                                            <p:outputLabel value="123457#{linha.argumento1}" />
                                        </c:forEach>
                                    </h:panelGrid>
                                        
                                </p:outputPanel>

                                <p:commandButton value="Concluir" type="submit" styleClass="ui-confirmdialog-yes" action="#{movimentosReceberSocialBean.concluirMescla}" style="clear: both; float: left" icon="ui-icon-check"/>  
                                <p:commandButton value="Fechar" type="button" styleClass="ui-confirmdialog-no" onclick="PF('i_dlg_mesclar').hide()" style="float: left" icon="ui-icon-close"/>       
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_dados" header="Ver Mais" resizable="false" modal="true">
                                <h:panelGrid id="i_dados">
                                    <h:panelGrid columns="4" style="width: 100%">
                                        <h:column>
                                            <h:outputLabel value="Data / Boleto" style="float: left"/><br />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.data} - #{movimentosReceberSocialBean.boleto}" style="float: left; font-weight: bold"/>
                                        </h:column>

                                        <h:column>
                                            <div>
                                                <h:outputLabel value="Lote Baixa" style="float: right"/><br />
                                                <h:outputLabel value="#{movimentosReceberSocialBean.id_baixa}" style="float: right; font-weight: bold"/>
                                            </div>
                                        </h:column>
                                    </h:panelGrid>

                                    <br />
                                    <h:panelGrid>
                                        <h:outputLabel value="Beneficiário" />
                                        <h:outputLabel value="#{movimentosReceberSocialBean.beneficiario}" style="font-weight: bold"/>
                                    </h:panelGrid>

                                    <br />
                                    <h:panelGrid columns="4" style="background: #e2e2e2; width: 100%">
                                        <h:column>
                                            <h:outputLabel value="Dias em Atraso" style="float: left"/><br />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.diasAtraso}" style="float: left; font-weight: bold"/>
                                        </h:column>

                                        <h:column>
                                            <div>
                                                <h:outputLabel value="Multa / Juros / Correção" style="float: right"/><br />
                                                <h:outputLabel value="#{movimentosReceberSocialBean.multa} - #{movimentosReceberSocialBean.juros} - #{movimentosReceberSocialBean.correcao}" style="float: right; font-weight: bold"/>
                                            </div>
                                        </h:column>
                                    </h:panelGrid>

                                    <br />
                                    <h:panelGrid>
                                        <h:outputLabel value="Caixa"/><br />
                                        <h:outputLabel value="#{movimentosReceberSocialBean.caixa}" style="font-weight: bold"/>
                                    </h:panelGrid>

                                    <h:panelGrid columns="2" style="background: #e2e2e2; width: 100%">
                                        <h:column>
                                            <h:outputLabel value="Documento" style="float: left"/><br />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.boleto}" style="float: left; font-weight: bold"/>
                                        </h:column>

                                        <h:column>
                                            <div>
                                                <h:outputLabel value="Tipo / Referência" style="float: right"/><br />
                                                <h:outputLabel value="#{movimentosReceberSocialBean.tipo} - #{movimentosReceberSocialBean.referencia}" style="float: right; font-weight: bold"/>
                                            </div>
                                        </h:column>
                                    </h:panelGrid>

                                    <br />

                                    <h:panelGrid rendered="#{!empty(movimentosReceberSocialBean.titular)}">
                                        <h:outputLabel value="-- Dados do Sócio --" style="font-size: 11pt!important" />
                                        <br />
                                        <h:panelGrid>
                                            <h:outputLabel value="Titular" />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.titular}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Matrícula" />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.matricula}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Categoria" />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.categoria}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Grupo" />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.grupo}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Status" />
                                            <h:outputLabel value="#{movimentosReceberSocialBean.status}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                    </h:panelGrid>
                                </h:panelGrid>
                            </p:dialog>

                        </h:form>
                    </p:panel>

                    <p:ajaxStatus id="i_status" onstart="PF('i_dlg_modal').show();" onsuccess="PF('i_dlg_modal').hide();" />
                    <p:dialog modal="true" widgetVar="i_dlg_modal" header="Status" draggable="false" closable="false">  
                        <h:outputLabel value="Aguarde ..." />
                    </p:dialog> 
                </f:view>
                <!-- FINALIZA div wrap main -->
            </div>
        </div>
        <!-- FINALIZA div wrap main -->

        <div id="footerx">
            <f:subview id="footer">
                <ui:include src="templates/templateFooter.xhtml"/>
            </f:subview>
        </div>                
    </h:body>
</ui:composition>