<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Sindical - Movimentos a Receber</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important;} 
            .ui-button { padding: 3px!important; }
            
            .ui-datatable tr.ui-datatable-even:hover, .ui-datatable tr.ui-datatable-odd:hover {
                background: #ECF3FE;
            }
            
        </style>
        
        <script type="text/javascript">
            
        </script>
    </h:head>
    <h:body>
        <!-- INICIA DIV wrap e main -->
        <div id="wrapx">
            <div id="mainx">
                <!-- INICIA DIV wrap e main -->  
                <f:subview id="header">
                    <ui:include src="templatePrime.xhtml"/>
                </f:subview>
                <f:view>
                    <p:panel styleClass="wrapper" style="border: 0px;">
                        <h:outputText value="Movimentos a Receber" styleClass="fonteHeader" />
                        <h:form id="formMovimentosReceber">
                            <p:panel styleClass="fundoCinza" style="clear: both">
                                <h:panelGrid columns="2" style="width: 100%">
                                    <p:column>
                                        <p:commandButton value="Adicionar uma Pessoa" action="#{chamadaPaginaBean.pesquisaPessoa}" rendered="#{movimentosSocialBean.pessoa.id == -1}"/>
                                        <p:commandButton value="Pesquisar outra Pessoa" action="#{chamadaPaginaBean.pesquisaPessoa}" rendered="#{movimentosSocialBean.pessoa.id != -1}"/>
                                        <h:outputText value="#{movimentosSocialBean.pessoa.nome}" title="#{movimentosSocialBean.pessoa.nome}" style="margin-left: 20px; font-weight: bold"/>
                                    </p:column>
                                    
                                    <p:column>
                                        <p:commandButton ajax="false" action="#{chamadaPaginaBean.pesquisaPessoa()}" actionListener="#{movimentosSocialBean.adicionarPesquisa()}" value="Adicionar mais Pessoas" rendered="#{movimentosSocialBean.listaPessoa.size() > 0}" style="margin-left: 10px; cursor: pointer; float: right" /> 
                                    </p:column>
                                </h:panelGrid>
                                
                                <h:panelGrid style="clear: both;" rendered="#{movimentosSocialBean.listaPessoa.size() > 1}">
                                    <p:dataGrid value="#{movimentosSocialBean.listaPessoa}" var="linha" id="tbl_list" rowIndexVar="index">
                                        <h:outputLabel value="#{linha.nome}" rendered="#{index != 0}" />
                                        <p:commandButton icon="ui-icon-trash" action="#{movimentosSocialBean.removerPessoaLista(index)}" rendered="#{index != 0}" update=":formMovimentosReceber" title="Clique para remover #{linha.nome} da Lista"/>
                                    </p:dataGrid>
                                </h:panelGrid>
                            </p:panel>
                                       
                            <h:panelGrid style="float: left; clear: both; margin-top: 10px; margin-bottom: 10px" columns="8" id="i_panel" rendered="#{movimentosSocialBean.listaMovimento.size() > 0 or movimentosSocialBean.pessoa.id != -1}">
                                <p:column>
                                    <h:outputText value="Filtrar por" /><br />
                                    <p:selectOneMenu value="#{movimentosSocialBean.porPesquisa}" style="padding-right: 10px; margin-right: 20px">
                                        <p:ajax event="change" update="formMovimentosReceber" listener="#{movimentosSocialBean.atualizarStatus}"/>
                                        <f:selectItem itemValue="todos"    itemLabel="Todos"/>
                                        <f:selectItem itemValue="abertos"  itemLabel="Abertos"/>
                                        <f:selectItem itemValue="quitados" itemLabel="Quitados"/>
                                    </p:selectOneMenu>
                                </p:column>
                                
                                <p:column>
                                    <h:outputText value="Total em Aberto" /><br />
                                    <p:inputText readonly="true" size="10" value="#{movimentosSocialBean.total}" style="font-weight: bold; margin-right: 20px"/>
                                </p:column>
                                    
                                <p:column>
                                    <h:outputText value="Acréscimo" /><br />
                                    <p:inputText readonly="true" size="10" value="#{movimentosSocialBean.acrescimo}" style="font-weight: bold; margin-right: 20px"/>
                                </p:column>
                                   
                                <p:column>
                                    <h:outputText value="Desconto"/><br />
                                    <p:inputText id="i_desconto" size="10" value="#{movimentosSocialBean.desconto}" style="margin-right: 20px">
                                        <p:ajax event="blur" update="i_desconto tbl" listener="#{movimentosSocialBean.calculoDesconto()}" />
                                    </p:inputText>
                                </p:column>
                                
                                <p:column>
                                    <h:outputText value="Total Calculado em Aberto"/><br />
                                    <p:inputText readonly="true" value="#{movimentosSocialBean.totalCalculado}" style="font-weight: bold; margin-right: 20px" />
                                </p:column>

                                <p:column>
                                    <br />
                                    <p:commandButton value="Baixar" title="Baixar este movimento" action="#{movimentosSocialBean.telaBaixa()}" rendered="#{movimentosSocialBean.porPesquisa != 'quitados'}" update="formMovimentosReceber" />
                                </p:column>
                                
                                <p:column>
                                    <br />
                                    <p:commandButton value="Acordo" title="Fazer um acordo" action="#{movimentosSocialBean.telaAcordo()}" rendered="#{movimentosSocialBean.porPesquisa != 'quitados'}" update="formMovimentosReceber"/>
                                </p:column>
                                
                                <p:column>
                                    <br />
                                    <p:commandButton value="Estornar" title="Estornar Movimentos Baixados" onclick="PF('i_dlg_estorno').show()" rendered="#{movimentosSocialBean.porPesquisa != 'abertos'}"/>
                                </p:column>
                            </h:panelGrid>
                            
                            <h:panelGrid style="clear: both; width: 100%">
                                <p:messages id="i_msg" showDetail="true" closable="true" />  
                            </h:panelGrid>
                            
                            <p:dataTable value="#{movimentosSocialBean.listaMovimento}" var="linha" style="clear: both; font-size: 8pt!important" id="tbl" paginator="true" rows="20" emptyMessage="Nenhuma pendência foi encontrada!">
                                <p:column style="text-align: center;">
                                    <p:selectBooleanCheckbox value="#{linha.argumento0}" disabled="#{linha.argumento25}">
                                        <p:ajax event="change" update="tbl :formMovimentosReceber:i_panel" listener="#{movimentosSocialBean.calculoDesconto()}"/>
                                    </p:selectBooleanCheckbox>
                                </p:column>
                                
                                <p:column headerText="Titular">
                                    <p:commandLink value="#{linha.argumento13}" action="#{movimentosSocialBean.complementoPessoa(linha)}" onclick="i_dlg_dados.show()" update=":formMovimentosReceber:i_dados" style="font-size: 8pt!important"/>
                                </p:column>
                                
                                <p:column headerText="Serviços">
                                    <h:outputText value="#{linha.argumento2}" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column style="text-align: center;" headerText="Vencimento">
                                    <h:outputText value="#{linha.argumento5}" style="font-size: 8pt!important"/>
                                </p:column>

                                <p:column headerText="Valor Base">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento6}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column headerText="Acréscimo">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento7}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column headerText="Desconto">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento8}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column headerText="Vl. Calculado">
                                    <h:outputText value="R$ " />
                                    <h:outputText value="#{linha.argumento9}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column style="text-align: center;" headerText="Data Baixa">
                                    <h:outputText value="#{linha.argumento10}" />
                                </p:column>

                                <p:column headerText="Valor Pago">
                                    <h:outputText value="R$ "/>
                                    <h:outputText value="#{linha.argumento11}" style="font-size: 8pt!important; float: right"/>
                                </p:column>

                                <p:column style="text-align: center;" headerText="E/S">
                                    <h:outputText value="#{linha.argumento12}" style="font-size: 8pt!important"/>
                                </p:column>
                                
                                <p:column style="text-align: center;" headerText="Mais">
                                    <p:commandLink ajax="false" value="Alterar" action="#{movimentosSocialBean.telaMovimento(linha.argumento1)}"/>
                                </p:column>
                                
                                <p:column style="text-align: center;" headerText="Recibo">
                                    <h:commandLink target="_blank" action="#{movimentosSocialBean.recibo(linha.argumento1)}" rendered="#{!empty(linha.argumento10)}" title="Imprimir este Recibo">
                                        <p:commandButton icon="ui-icon-print"  title="Imprimir este Recibo"/>
                                    </h:commandLink>
                                </p:column>
                            </p:dataTable>      
                            
                            <p:dialog widgetVar="i_dlg_estorno" header="Deseja estornar este Movimento" resizable="false" width="400" modal="true">
                                <p:commandButton value="Sim"      type="submit" styleClass="ui-confirmdialog-yes" action="#{movimentosSocialBean.estornarBaixa()}" update="formMovimentosReceber" onclick="i_dlg_estorno.hide()" style="clear: both; float: left" icon="ui-icon-check"/>  
                                <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" onclick="i_dlg_estorno.hide()" style="float: left" icon="ui-icon-close"/>       
                            </p:dialog>
                            
                            <p:dialog widgetVar="i_dlg_dados" header="Ver Mais" resizable="false" modal="true">
                                <h:panelGrid id="i_dados">
                                    <h:panelGrid columns="4" style="width: 100%">
                                        <h:column>
                                            <h:outputLabel value="Data / Boleto" style="float: left"/><br />
                                            <h:outputLabel value="#{movimentosSocialBean.data} - #{movimentosSocialBean.boleto}" style="float: left; font-weight: bold"/>
                                        </h:column>

                                        <h:column>
                                            <div>
                                                <h:outputLabel value="Lote Baixa" style="float: right"/><br />
                                                <h:outputLabel value="#{movimentosSocialBean.id_baixa}" style="float: right; font-weight: bold"/>
                                            </div>
                                        </h:column>
                                    </h:panelGrid>

                                    <br />
                                    <h:panelGrid>
                                        <h:outputLabel value="Beneficiário" />
                                        <h:outputLabel value="#{movimentosSocialBean.beneficiario}" style="font-weight: bold"/>
                                    </h:panelGrid>

                                    <br />
                                    <h:panelGrid columns="4" style="background: #e2e2e2; width: 100%">
                                        <h:column>
                                            <h:outputLabel value="Dias em Atraso" style="float: left"/><br />
                                            <h:outputLabel value="#{movimentosSocialBean.diasAtraso}" style="float: left; font-weight: bold"/>
                                        </h:column>

                                        <h:column>
                                            <div>
                                                <h:outputLabel value="Multa / Juros / Correção" style="float: right"/><br />
                                                <h:outputLabel value="#{movimentosSocialBean.multa} - #{movimentosSocialBean.juros} - #{movimentosSocialBean.correcao}" style="float: right; font-weight: bold"/>
                                            </div>
                                        </h:column>
                                    </h:panelGrid>

                                    <br />
                                    <h:panelGrid>
                                        <h:outputLabel value="Caixa"/><br />
                                        <h:outputLabel value="#{movimentosSocialBean.caixa}" style="font-weight: bold"/>
                                    </h:panelGrid>

                                    <h:panelGrid columns="2" style="background: #e2e2e2; width: 100%">
                                        <h:column>
                                            <h:outputLabel value="Documento" style="float: left"/><br />
                                            <h:outputLabel value="#{movimentosSocialBean.documento}" style="float: left; font-weight: bold"/>
                                        </h:column>

                                        <h:column>
                                            <div>
                                                <h:outputLabel value="Tipo / Referência" style="float: right"/><br />
                                                <h:outputLabel value="#{movimentosSocialBean.tipo} - #{movimentosSocialBean.referencia}" style="float: right; font-weight: bold"/>
                                            </div>
                                        </h:column>
                                    </h:panelGrid>

                                    <br />

                                    <h:panelGrid rendered="#{!empty(movimentosSocialBean.titular)}">
                                        <h:outputLabel value="-- Dados do Sócio --" style="font-size: 11pt!important" />
                                        <br />
                                        <h:panelGrid>
                                            <h:outputLabel value="Titular" />
                                            <h:outputLabel value="#{movimentosSocialBean.titular}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Matrícula" />
                                            <h:outputLabel value="#{movimentosSocialBean.matricula}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Categoria" />
                                            <h:outputLabel value="#{movimentosSocialBean.categoria}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Grupo" />
                                            <h:outputLabel value="#{movimentosSocialBean.grupo}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:outputLabel value="Status" />
                                            <h:outputLabel value="#{movimentosSocialBean.status}" style="font-weight: bold"/>
                                        </h:panelGrid>

                                    </h:panelGrid>
                                </h:panelGrid>
                            </p:dialog>
                            
                        </h:form>
                    </p:panel>
                    
                    <p:ajaxStatus id="i_status" onstart="i_dlg_modal.show();" onsuccess="i_dlg_modal.hide();" />
                    <p:dialog modal="true" widgetVar="i_dlg_modal" header="Status" draggable="false" closable="false">  
                        <h:outputLabel value="Aguarde ..." />
                    </p:dialog> 
                </f:view>
                <!-- FINALIZA div wrap main -->
            </div>
        </div>
        <!-- FINALIZA div wrap main -->

        <div id="footerx">
            <f:subview id="footer">
                <ui:include src="templateFooter.xhtml"/>
            </f:subview>
        </div>                
    </h:body>
</ui:composition>