<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    
    <h:head>
        <title>Envio de Arquivos</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <script type="text/javascript">
            function atualizar(){
                fecharModal('divProcesso');
            }
        </script>        
    </h:head>
    <h:body class="divMenu">
        <div style="z-index: 5000; position: absolute; top: 100px; ">
            <h:form id="formEnviarArquivo">   
                    <br /><br />
                    <div class="divMae divFundo" style="width: 1180px" align="left">
                        
                        <h:outputLabel value="Assunto: " styleClass="fontePadrao" for="idAssunto"/>
                        <h:inputText id="idAssunto" value="#{enviarArquivosBean.mensagem.assunto}" size="60"/>
                        <a4j:commandLink onclick="modalOpcao('divSalvar');" styleClass="idSalvar iLink" value="Anexos" title="Ver arquivos anexados" style="width: 100px;" render="idQuantidadeAnexo"/>
                        <h:outputText id="idQuantidadeAnexo" value="#{enviarArquivosBean.quantidadeAnexo} Anexo (s)" />
                        <br /><br />
                        <div class="divMae divFundo bg-white" style="overflow:auto; height:300px; margin: auto 0;">
                            <h:outputLabel value="Destinatario (s): " styleClass="fontePadrao"/>
                            <br />
                            <rich:panel styleClass="no-border no-margin">
                                <rich:dataTable value="#{enviarArquivosBean.listaEmpresas}" var="linha" iterationStatusVar="it" id="tblContabilidade">
                                    <rich:column style="text-align: center;">
                                        <f:facet name="header">
                                            <h:outputText value="#" />
                                        </f:facet>
                                        <h:outputText value="#{it.index}"/>
                                    </rich:column>                                    
                                    
                                    <rich:column styleClass="coluna">
                                        <f:facet name="header">
                                            <h:selectBooleanCheckbox value="#{enviarArquivosBean.chkMarcaTodos}">
                                                <a4j:ajax event="change" listener="#{enviarArquivosBean.marcaTodos}" render="tblContabilidade" />
                                            </h:selectBooleanCheckbox>
                                        </f:facet>
                                        <h:selectBooleanCheckbox value="#{linha.argumento0}" id="idCheckContabilidade#{linha.argumento1.id}">
                                            <a4j:ajax event="change" listener="#{enviarArquivosBean.marcar(it.index)}" render="idCheckContabilidade#{linha.argumento1.id} tblContabilidade"/>
                                        </h:selectBooleanCheckbox>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="Documento - Nome"/>
                                        </f:facet>
                                        <h:outputText value="#{linha.argumento2}"/>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="Telefone"/>
                                        </f:facet>
                                        <h:outputText value="#{linha.argumento3}"/>
                                    </rich:column>
                                    
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="Qntd. Empresas"/>
                                        </f:facet>
                                        <h:outputText value="#{linha.argumento4}"/>
                                    </rich:column>
                        
                                    
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="E-mail"/> 
                                        </f:facet>
                                        <h:outputText value="#{linha.argumento5}"/>
                                    </rich:column>
                                </rich:dataTable>
                            </rich:panel> 
                        </div>
                        <br /><br />
                        <div class="divMae divFundo bg-white" style="overflow:auto; height:300px; margin: auto 0;">
                            <h:outputLabel value="Mensagem: " styleClass="fontePadrao"/><br /><br />
                            <rich:editor value="#{enviarArquivosBean.mensagem.mensagem}"></rich:editor>
                        </div>
                        <div class="clear"></div>
                        <br /><br />
                        <a4j:commandLink styleClass="idNovo iLink" style="width: 150px;" value="Enviar E-mails" action="#{enviarArquivosBean.enviarArquivos}"  onclick="modalOpcao('divProcesso');" oncomplete="atualizar(); modalMensagem();" render="outConfirma" />
                        <a4j:commandLink styleClass="idNovo iLink" style="width: 150px;" value="Novo" action="#{enviarArquivosBean.novo}"/>
                    </div>               
                <br />
                <div id="boxes">
                    <div id="divSalvar" class="window" style="width: 600px; height: 500px;">
                        <a4j:commandLink styleClass="close closeModal" title="Fechar">
                            <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                        </a4j:commandLink>
                        <br />
                        <center>
                            <label for="idUpload" style="cursor: pointer; float: right">
                                <div class="idNovo iLink" style="width: 200px;">
                                    Enviar arquivo 
                                </div>
                            </label>                            
                            <h:panelGrid columns="2">
                                <h:outputText value="Arquivos Anexados" styleClass="fontePadrao"/>
                                <br /><br />
                                <rich:dataTable value="#{enviarArquivosBean.listaArquivosContabilidade}" var="linha" iterationStatusVar="it" id="idArquivos">
                                     <rich:column style="text-align: center;">
                                         <f:facet name="header">
                                             <h:outputText value="#" />
                                         </f:facet>
                                         <h:outputText value="#{it.index}"/>
                                     </rich:column>

                                     <rich:column styleClass="coluna">
                                         <f:facet name="header">
                                             <h:outputText value="Excluir"/>
                                         </f:facet>
                                         <a4j:commandButton image="/Imagens/excluirp.png" disabled="#{controleAcessoBean.botaoExcluir}">
                                             <a4j:ajax event="click" listener="#{enviarArquivosBean.excluirArquivosContabilidade(it.index)}" render="idArquivos idQuantidadeAnexo" />
                                         </a4j:commandButton>
                                     </rich:column>

                                     <rich:column>
                                         <f:facet name="header">
                                             <h:outputText value="Nome do Anexo"/>
                                         </f:facet>
                                         <h:outputText value="#{linha.argumento1}"/>
                                     </rich:column>
                                </rich:dataTable>                                 
                            </h:panelGrid>
                        </center>
                        <br />
                    </div>
                    <div id="mask"></div>
                </div>
                <div id="boxes">
                    <div id="divMensagem" class="window">
                        <a4j:commandLink styleClass="close closeModal" title="Fechar">
                            <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                        </a4j:commandLink>
                        <br />
                        <center>
                            <h:outputText id="outConfirma" value="#{enviarArquivosBean.msgConfirma}" styleClass="fontePadrao"/>
                            <br /><br />
                            <a4j:commandLink styleClass="idNovo iLink closeModal" value="OK" action="enviarArquivos" title="OK" render="@form"/>
                        </center>
                    </div>
                    <div id="mask"></div>
                </div>
                    <div id="boxes">
                        <div id="divProcesso" class="window">
                            <br />
                            <center>
                                <h:outputText value="Aguarde ..." styleClass="fontePadrao" style="color: white"/>
                            </center>
                        </div>
                        <div id="mask"></div>
                    </div>                  
            </h:form>
        </div>        
        <f:subview id="header">
            <ui:include src="template.xhtml"/>
            <ui:include src="templateLinks.xhtml"/>
        </f:subview>
        <f:view>
            <c:set scope="request" var="object" value="${enviarArquivosBean.mensagem}"/>
            <h:form>
                <center>
                    <div class="headerPanel">
                        <h:outputText value="Envio de Arquivos Contabilidade" styleClass="fontePanel" style="width: 100%;"/>
                    </div>                  
                </center>
            </h:form>
            <form action="servletEnvioArquivoContabilidade" name="formEnvioArquivo" enctype="multipart/form-data" method="post">  
                <input id="idUpload" type="file" name="nArquivo" onchange="submit();" style="visibility: hidden" accesskey="u"/>
                <input type="hidden" name="nTipoEnvio" value="ArquivoContabilidade" />
            </form>            
        </f:view>
    </h:body>
</ui:composition>