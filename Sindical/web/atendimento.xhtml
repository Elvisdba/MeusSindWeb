<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    
    <h:head>
        <title>Atendimento Pessoa</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
    </h:head>
    <h:body class="divMenu">
        <f:subview id="header">
            <ui:include src="template.xhtml"/>
            <ui:include src="templateLinks.xhtml"/>
        </f:subview>
        <f:view>
            <c:set scope="request" var="object" value="${atendimentoBean.ateMovimento}"/>
            <h:form id="formAtendimento">
                <center>
                    <div class="headerPanel">
                        <h:outputText value="Atendimento Pessoa" styleClass="fontePanel" style="width: 100%;"/>
                    </div>
                    <br /><br />
                    <div class="divMae divFundo" align="left">
                        <h:panelGrid id="idForm" columns="2" columnClasses="coluna1, coluna2 " style="margin-bottom: 25px;" rendered="#{!atendimentoBean.editaPessoa}">
                            <h:column>
                                <h:outputLabel value="Filial: " />
                            </h:column>
                            <h:column>
                                <h:outputText value="#{atendimentoBean.ateMovimento.filial.matriz.pessoa.nome}" />
                                <h:outputText value="#{atendimentoBean.mensagem}" rendered="#{atendimentoBean.ateMovimento.filial.matriz.pessoa.id == -1}"/>
                            </h:column>                            
                            <h:column>
                                <h:outputLabel value="Data Emissão: " />
                            </h:column>
                            <h:column>
                                <h:inputText value="#{atendimentoBean.ateMovimento.dataEmissaoString}" class="data" maxlength="10" size="6" disabled="true"/>
                            </h:column>                            
                            <h:column>
                                <h:outputLabel value="Horário: " />
                            </h:column>
                            <h:column>
                                <h:inputText value="#{atendimentoBean.horaEmissaoString}" class="hora" maxlength="5" size="3" disabled="true"/>
                            </h:column>
                            <h:column>
                                <h:outputLabel value="Operações: "/>
                            </h:column>                            
                            <h:column>
                                <h:selectOneMenu id="idOperacoes" value="#{atendimentoBean.idOperacao}">
                                    <a4j:ajax event="change" render="this"/>
                                    <f:selectItems value="#{atendimentoBean.listaAtendimentoOperacoes}"/>
                                </h:selectOneMenu>
                            </h:column>
                            <h:column>
                                <h:outputLabel value="CPF:" />
                            </h:column>
                            <h:column>
                                <h:inputText value="#{atendimentoBean.ateMovimento.pessoa.CPF}" maxlength="14" size="10" class="cpf" id="idCPF" disabled="#{atendimentoBean.desabilitaCamposPessoa}">
                                    <a4j:ajax event="blur" listener="#{atendimentoBean.verificaCPF('cpf')}" render="idCPF idRG idNome idTelefone idEditarPessoa idMsgCPF idVerificaPessoaOposicao"/>
                                    <a4j:ajax id="idVerificaPessoaOposicao" event="change" listener="#{atendimentoBean.verificaPessoaOposicao}" render="idPessoaOposicao"/>
                                </h:inputText>
                                <h:outputText value=" #{atendimentoBean.msgCPF} " id="idMsgCPF" class="fontePadraoVermelho margin-left" /> 
                                <h:outputText value=" #{atendimentoBean.msgOposicao} " id="idPessoaOposicao" class="fontePadraoVermelho margin-left" />
                            </h:column>
                            <h:column>
                                <h:outputLabel value="RG: " />
                            </h:column>
                            <h:column>
                                <h:inputText id="idRG" value="#{atendimentoBean.ateMovimento.pessoa.rg}" maxlength="14" size="10" disabled="#{atendimentoBean.desabilitaCamposPessoa}">
                                    <a4j:ajax event="blur" listener="#{atendimentoBean.verificaCPF('rg')}" render="idRG idCPF idNome idTelefone idEditarPessoa" />
                                </h:inputText>
                            </h:column>
                            <h:column>
                                <h:outputLabel value="Nome: " />
                            </h:column>
                            <h:column>
                                <h:inputText id="idNome" value="#{atendimentoBean.ateMovimento.pessoa.nome}" maxlength="50" size="50" disabled="#{atendimentoBean.desabilitaCamposPessoa}" /> 
                                <a4j:commandButton id="idEditarPessoa" title="Alterar Pessoa" styleClass="fonteLinks margin-left" action="#{atendimentoBean.editarPessoa}" value="Alterar Pessoa" render="@form" disabled="#{!atendimentoBean.desabilitaCamposPessoa}" style="text-transform: uppercase;"/>
                            </h:column>
                            <h:column>
                                <h:outputLabel value="Telefone:" />
                            </h:column>
                            <h:column>
                                <h:inputText id="idTelefone" class="telefone" value="#{atendimentoBean.ateMovimento.pessoa.telefone}" maxlength="15" size="10" disabled="#{atendimentoBean.desabilitaCamposPessoa}" />
                            </h:column>
                            <h:column>
                                <h:outputLabel value="Histórico: "/>
                            </h:column>
                            <h:column>
                                <h:inputTextarea value="#{atendimentoBean.ateMovimento.historico}" cols="50" rows="5" />
                            </h:column>
                        </h:panelGrid>
                        <h:panelGrid id="idFormS" columns="2" columnClasses="coluna1, coluna2 " style="margin-bottom: 25px;" rendered="#{atendimentoBean.editaPessoa}">
                            <h:column>
                                <h:outputLabel value="Editar Pessoa" styleClass="fontePadraoNegritoMedio" />
                            </h:column>
                            <h:column>
                            </h:column>
                            <h:column>
                                <h:outputLabel value="CPF:" />
                            </h:column>
                            <h:column>
                                <h:inputText value="#{atendimentoBean.ateMovimento.pessoa.CPF}" maxlength="14" size="10" class="cpf" />
                            </h:column>
                            <h:column>
                                <h:outputLabel value="RG: " />
                            </h:column>
                            <h:column>
                                <h:inputText value="#{atendimentoBean.ateMovimento.pessoa.rg}" maxlength="14" size="10" />
                            </h:column>
                            <h:column>
                                <h:outputLabel value="Nome: " />
                            </h:column>
                            <h:column>
                                <h:inputText value="#{atendimentoBean.ateMovimento.pessoa.nome}" maxlength="50" size="50" style="text-transform: uppercase;"/>
                            </h:column>
                            <h:column>
                                <h:outputLabel value="Telefone:" />
                            </h:column>
                            <h:column>
                                <h:inputText class="telefone" value="#{atendimentoBean.ateMovimento.pessoa.telefone}" maxlength="15" size="10" />
                            </h:column>
                        </h:panelGrid>
                        <a4j:commandLink onclick="modalOpcao('divSalvar');" styleClass="idSalvar iLink" value="Salvar" title="Adicionar Atendimento" rendered="#{!atendimentoBean.editaPessoa}" disabled="#{controleAcessoBean.botaoSalvar}"/>
                        <a4j:commandLink styleClass="idNovo iLink" value="Novo" title="Novo" action="#{atendimentoBean.novo}" render="idFilial" rendered="#{!atendimentoBean.editaPessoa}" />
                        <a4j:commandLink onclick="modalOpcao('divExcluir');" styleClass="idSalvar iLink" value="Excluir" title="Exluir Atendimento" rendered="#{!atendimentoBean.editaPessoa}" disabled="#{controleAcessoBean.botaoExcluir}"/>
                        <a4j:commandLink onclick="modalOpcao('divSalvar');" styleClass="idSalvar iLink" value="Salvar" title="Salvar Pessoa" rendered="#{atendimentoBean.editaPessoa}" disabled="#{controleAcessoBean.botaoSalvar}"/>
                        <a4j:commandLink title="Concluir Edição" styleClass="idSalvar iLink fonteLinks margin-left" action="#{atendimentoBean.voltar}" render="tblAteMovimento idNome idEditarPessoa idRG idTelefone" value="Concluir Edição" style="width: 150px;" rendered="#{atendimentoBean.editaPessoa}"/>
                        <a4j:status><f:facet name="start"><h:graphicImage value="/Imagens/espere.gif" alt="Aguarde"/></f:facet></a4j:status>
                        <div style="clear: both;"></div>
                        <br /><br />
                        <div class="divMae divFundo no-margin" style="background: white; margin-top: 15px;"  align="left">
                            <h:column rendered="#{!atendimentoBean.editaPessoa}">
                                <h:outputLabel value="Filtrar: "/>
                            </h:column>
                            <h:selectOneMenu value="#{atendimentoBean.porPesquisa}" rendered="#{!atendimentoBean.editaPessoa}">
                                <a4j:ajax event="change" render="tblAteMovimento" />
                                <f:selectItem itemValue="ontem" itemLabel="Ontem" />
                                <f:selectItem itemValue="hoje" itemLabel="Hoje" />
                                <f:selectItem itemValue="60" itemLabel="Ultimos 60 dias" />
                                <f:selectItem itemValue="todos" itemLabel="Todos" />
                            </h:selectOneMenu>                          
                            <br /><br />
                            <h:column rendered="#{!atendimentoBean.editaPessoa}">
                                <h:panelGroup style="overflow:auto;" layout="block">
                                    <rich:dataTable value="#{atendimentoBean.listaAteMovimento}" iterationStatusVar="it" var="linha" style="width:100%" id="tblAteMovimento">                            
                                        <rich:column styleClass="colunaPesquisa">
                                            <f:facet name="header">
                                                <h:outputText value="Alterar"/>
                                            </f:facet>
                                            <a4j:commandLink action="#{atendimentoBean.editar}" value="#{linha.id}" render="idForm idOperacoes iFilial formAtendimento idEditarPessoa">
                                                <a4j:param value="#{it.index}" assignTo="#{atendimentoBean.idIndexMovimento}"/>
                                            </a4j:commandLink>
                                        </rich:column>                                 
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:outputText value="Data Emissão"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.dataEmissaoString}" styleClass="fontePadrao"/>
                                        </rich:column>
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:outputText value="Horario"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.horaEmissao}" styleClass="fontePadrao"/>
                                        </rich:column>
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:outputText value="Nome"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.pessoa.nome}" styleClass="fontePadrao" style="text-transform: uppercase;"/>
                                        </rich:column>
                                        <rich:column>
                                            <f:facet name="header">
                                                <h:outputText value="CPF"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.pessoa.CPF}" styleClass="fontePadrao"/>
                                        </rich:column>
                                        <rich:column style="text-align: center">
                                            <f:facet name="header">
                                                <h:outputText value="RG"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.pessoa.rg}" styleClass="fontePadrao"/>
                                        </rich:column>
                                        <rich:column style="text-align: center">
                                            <f:facet name="header">
                                                <h:outputText value="Telefone"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.pessoa.telefone}" styleClass="fontePadrao"/>
                                        </rich:column>
                                        <rich:column style="text-align: center">
                                            <f:facet name="header">
                                                <h:outputText value="Operação"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.operacao.descricao}" styleClass="fontePadrao"/>
                                        </rich:column>
                                        <rich:column style="text-align: center">
                                            <f:facet name="header">
                                                <h:outputText value="Filial"/>
                                            </f:facet>
                                            <h:outputLabel value="#{linha.filial.matriz.pessoa.nome}" styleClass="fontePadrao"/>
                                        </rich:column>
                                    </rich:dataTable>
                                </h:panelGroup>
                            </h:column>                    
                        </div>
                    </div>
                    <div id="boxes">
                        <div id="divSalvar" class="window">
                            <a4j:commandLink styleClass="close closeModal" title="Fechar">
                                <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                            </a4j:commandLink>
                            <br />
                            <center>
                                <h:panelGrid columns="2">
                                    <h:outputText value="Deseja salvar este Registro?" styleClass="fontePadrao"/>
                                    <a4j:status><f:facet name="start"><h:graphicImage value="/Imagens/espere.gif" alt="Salvando"/></f:facet></a4j:status>
                                </h:panelGrid>

                                <br />
                                <a4j:commandLink styleClass="idNovo iLink" value="Sim" title="Salvar" action="#{atendimentoBean.salvar}" oncomplete="modalMensagem()" render="outConfirma @form idForm" rendered="#{!atendimentoBean.editaPessoa}"/>
                                <a4j:commandLink styleClass="idNovo iLink" value="Sim" title="Salvar" action="#{atendimentoBean.atualizarPessoa}" oncomplete="modalMensagem()" render="outConfirma @form idForm" rendered="#{atendimentoBean.editaPessoa}"/>
                                <a4j:commandLink styleClass="idNovo iLink closeModal" value="Não" title="Cancelar"/>
                            </center>
                        </div>
                        <div id="mask"></div>
                    </div>
                    <div id="boxes">
                        <div id="divExcluir" class="window">
                            <a4j:commandLink styleClass="close closeModal" title="Fechar">
                                <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                            </a4j:commandLink>
                            <br />
                            <center>
                                <h:panelGrid columns="2">
                                    <h:outputText value="Deseja excluir este Atendimento?" styleClass="fontePadrao"/>
                                    <a4j:status><f:facet name="start"><h:graphicImage value="/Imagens/espere.gif" alt="Excluindo"/></f:facet></a4j:status>
                                </h:panelGrid>
                                <br />
                                <a4j:commandLink styleClass="idNovo iLink" value="Sim" action="#{atendimentoBean.excluir}" title="Excluir" oncomplete="modalMensagem()" render="outConfirma @form"/>
                                <a4j:commandLink styleClass="idNovo iLink closeModal" value="Não" title="Cancelar"/>
                            </center>
                        </div>
                        <div id="mask"></div>
                    </div>
                    <div id="boxes">
                        <div id="divMensagem" class="window">
                            <a4j:commandLink styleClass="close closeModal" title="Fechar">
                                <h:graphicImage value="/Imagens/iconExcluir.png" alt="Fechar"/>
                            </a4j:commandLink>
                            <br />
                            <center>
                                <h:outputText id="outConfirma" value="#{atendimentoBean.msgConfirma} #{atendimentoBean.msg}" styleClass="fontePadrao"/>
                                <br /><br />
                                <a4j:commandLink styleClass="idNovo iLink closeModal" value="OK" action="atendimento" title="OK" render="tbl"/>
                            </center>
                        </div>
                        <div id="mask"></div>
                    </div>                    
                </center>
            </h:form>
        </f:view>
    </h:body>
</ui:composition>