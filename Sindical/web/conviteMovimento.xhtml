<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:cc="http://java.sun.com/jsf/composite">

    <h:head>
        <title>Convite</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
    </h:head>
    <h:body>
        <f:subview id="header">
            <ui:include src="templates/templatePrime.xhtml"/>
        </f:subview>
        <f:view>
            <ui:include src="templates/templateAcessoFilial.xhtml"/>
            <p:panel styleClass="wrapper no-border">
                <h:form id="form_convite">
                    <p:outputLabel value="Convite" styleClass="fonteHeader"/>
                    <c:set scope="request" var="object" value="${conviteMovimentoBean.conviteMovimento}"/>
                    <div class="clear"></div>
                    <p:panel id="i_panel_acao" styleClass="fundoCinza" style="height: 50px">
                        <h:panelGrid columns="8" style="float: left">
                            <p:commandButton value="Adicionar" id="id_click" update="i_panel_adicionar" action="#{conviteMovimentoBean.openDialog}" onclick="PF('dgl_adicionar').show();" />
                            <p:outputLabel value="Pesquisar: "/>
                            <p:inputMask id="i_mask" mask="#{conviteMovimentoBean.mascara}" value="#{conviteMovimentoBean.descricaoPesquisa}" disabled="#{conviteMovimentoBean.porPesquisa.equals('todos')}" size="70"/>
                            <h:outputLabel value="Por: "/>
                            <p:selectOneMenu id="idTipoClasse" value="#{conviteMovimentoBean.porPesquisa}">
                                <p:ajax event="change" update="i_mask, id_lista" listener="#{conviteMovimentoBean.conviteMovimentos.clear()}"/>
                                <f:selectItem itemValue="todos" itemLabel="Todos" />
                                <f:selectItem itemValue="codigo"  itemLabel="Código Convite" />
                                <f:selectItem itemValue="nome"  itemLabel="Nome Convidado" />
                                <f:selectItem itemValue="cpf"   itemLabel="CPF Convidado" />
                                <f:selectItem itemValue="rg"    itemLabel="RG Convidado" />
                                <f:selectItem itemValue="socio" itemLabel="Nome Sócio" />
                                <f:selectItem itemValue="socioCPF" itemLabel="CPF Sócio" />
                            </p:selectOneMenu>
                            <p:commandButton value="Inicial" action="#{conviteMovimentoBean.acaoPesquisaInicial}" actionListener="#{conviteMovimentoBean.conviteMovimentos.clear()}" update="id_lista"/>
                            <p:commandButton value="Parcial" action="#{conviteMovimentoBean.acaoPesquisaParcial}" actionListener="#{conviteMovimentoBean.conviteMovimentos.clear()}" update="id_lista"/>
                        </h:panelGrid>
                    </p:panel>
                    <p:panel styleClass="margin-top-max" id="id_lista" header="Convidados">
                        <p:dataTable value="#{conviteMovimentoBean.conviteMovimentos}" var="conviteMovimento" scrollHeight="400" scrollable="true" emptyMessage="Nenhum registro encontrado" id="id_lista_tbl">
                            <f:facet name="footer">
                                * Cod = Código - Selecione um convidado para editar
                            </f:facet>
                            <p:column width="25" styleClass="text-center">
                                <p:commandButton icon="ui-icon-link" action="#{conviteMovimentoBean.edit(conviteMovimento)}" title="Editar"/>
                            </p:column>
                            <p:column headerText="Cod." width="25" styleClass="text-center">
                                <p:commandLink value="#{conviteMovimento.id}" action="#{conviteMovimentoBean.edit(conviteMovimento)}" title="Editar"/>
                            </p:column>
                            <p:column headerText="Emissão" width="80" styleClass="text-center">
                                <h:outputText value="#{conviteMovimento.emissao}"/>
                            </p:column>
                            <p:column headerText="Validade" width="80" styleClass="text-center">
                                <h:outputText value="#{conviteMovimento.validade}"/>
                            </p:column>
                            <p:column headerText="Convidado" width="100">
                                <h:outputText value="#{conviteMovimento.sisPessoa.nome}" />
                            </p:column>
                            <p:column headerText="Sexo" styleClass="text-center" width="50">
                                <p:commandLink value="#{conviteMovimento.sisPessoa.sexo}" action="#"/>
                            </p:column>
                            <p:column headerText="Sócio">
                                <h:outputText value="#{conviteMovimento.pessoa.nome}"/>
                            </p:column>
                            <p:column headerText="Emissor" styleClass="text-center">
                                <h:outputText value="#{conviteMovimento.usuario.pessoa.nome}"/>
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                    <p:dialog id="i_adicionar" widgetVar="dgl_adicionar" modal="true" header="Cadastro de Convite" width="1024" resizable="true"  maximizable="true" minimizable="true" onShow="true" visible="#{conviteMovimentoBean.visibility}">
                        <p:ajax event="close" update="out_mensagem i_panel_adicionar id_lista" listener="#{conviteMovimentoBean.close}"/>  
                        <p:panel id="i_panel_adicionar" styleClass="no-border">
                            <h:outputScript name="tradutor_primefaces.js" library="js" />
                            <h:outputScript name="script_primefaces.js" library="js" />
                            <div style="float: left; width: 600px; margin-right: 15px;">
                                <p:panel header="Sócio">
                                    <h:panelGrid id="i_panel_convite" columns="2">
                                        <p:outputLabel value="Código:" />
                                        <p:outputLabel value="#{conviteMovimentoBean.socios.matriculaSocios.nrMatricula}" />
                                        <p:commandButton icon="ui-icon-search" title="Pesquisar sócio" action="#{chamadaPaginaBean.pesquisaSocios}" disabled="#{conviteMovimentoBean.desabilitaCampos}"/>
                                        <h:column>
                                            <p:outputLabel value="Pesquisar sócio" style="border-bottom: 1px dashed #888;" rendered="#{conviteMovimentoBean.socios.servicoPessoa.pessoa.id == -1}" />
                                            <p:outputLabel value="#{conviteMovimentoBean.socios.servicoPessoa.pessoa.nome}" rendered="#{conviteMovimentoBean.socios.servicoPessoa.pessoa.id != -1}"/>
                                        </h:column>
                                        <p:outputLabel value="Endereço:" />
                                        <h:column>
                                            <p:outputLabel value="#{conviteMovimentoBean.pessoaEndereco.endereco.enderecoToString} - Nº#{conviteMovimentoBean.pessoaEndereco.numero} - Tel. #{conviteMovimentoBean.pessoaEndereco.pessoa.telefone1}" rendered="#{conviteMovimentoBean.pessoaEndereco.id != -1}"/>
                                        </h:column>
                                        <p:outputLabel value="Usuário:" />
                                        <p:outputLabel value="#{conviteMovimentoBean.usuario.pessoa.nome}" />
                                        
                                        <p:selectBooleanCheckbox value="#{conviteMovimentoBean.conviteMovimento.cortesia}" itemLabel="Cortesia" disabled="#{conviteMovimentoBean.desabilitaCampos}">
                                            <p:ajax event="change" update="idDescricaoAutoriza idComboAutoriza, id_calcula_valor i_panel_convite" />
                                        </p:selectBooleanCheckbox>
                                        
                                        <h:column>
                                            <p:inputText value="#{conviteMovimentoBean.conviteMovimento.controleCortesia}" rendered="#{conviteMovimentoBean.conviteMovimento.cortesia}" placeholder="Digite um Controle Convite" size="50"/>
                                        </h:column>
                                        
                                        <h:column>
                                            <h:panelGrid id="idDescricaoAutoriza">
                                                <p:outputLabel value="Autorizada por: " rendered="#{conviteMovimentoBean.conviteMovimento.cortesia}"/>
                                            </h:panelGrid>
                                        </h:column>
                                        <h:column>
                                            <h:panelGrid id="idComboAutoriza">
                                                <p:selectOneMenu value="#{conviteMovimentoBean.idPessoaAutoriza}" rendered="#{conviteMovimentoBean.conviteMovimento.cortesia}" disabled="#{conviteMovimentoBean.desabilitaCampos}">
                                                    <f:selectItems value="#{conviteMovimentoBean.listPessoaAutoriza}" />
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                        </h:column>
                                    </h:panelGrid>
                                </p:panel>
                                <p:panel header="Convidado" styleClass="margin-top-max" id="i_panel_convidado">
                                    <h:panelGrid columns="2">
                                        <p:outputLabel value="Data:" />
                                        <h:column>
                                            <h:panelGrid columns="5">
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.emissao}" readonly="true" size="10"/>
                                                <p:outputLabel value="Convite: " rendered="#{conviteMovimentoBean.conviteMovimento.id != -1}"/>
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.id}" readonly="true" size="5" rendered="#{conviteMovimentoBean.conviteMovimento.id != -1}"/>
                                                <p:outputLabel value="Validade: " rendered="#{conviteMovimentoBean.conviteMovimento.id != -1}" style="color: red;"/>
                                                <p:inputText value="#{conviteMovimentoBean.validadeConvite(conviteMovimentoBean.conviteMovimento.emissao)}" readonly="true" rendered="#{conviteMovimentoBean.conviteMovimento.id != -1}" size="8" style="color: red;"/>
                                            </h:panelGrid>
                                        </h:column>
                                        <p:outputLabel value="Serviço:" />
                                        <h:column>
                                            <h:panelGrid columns="3" id="id_calcula_valor">
                                                <p:selectOneMenu value="#{conviteMovimentoBean.idServico}" disabled="#{conviteMovimentoBean.desabilitaCampos}">
                                                    <p:ajax event="change" update="id_valor_servico" />
                                                    <f:selectItems value="#{conviteMovimentoBean.conviteServicos}" />
                                                </p:selectOneMenu>
                                                <p:outputLabel value="Valor: " />
                                                <p:outputLabel value="#{conviteMovimentoBean.valorString}" id="id_valor_servico"/>
                                            </h:panelGrid>
                                        </h:column>
                                        <p:outputLabel value="CPF" />
                                        <h:column>
                                            <h:panelGrid columns="4">
                                                <p:inputMask mask="999.999.999-99" value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.documento}" disabled="#{conviteMovimentoBean.desabilitaCampos}">
                                                    <p:ajax event="blur" listener="#{conviteMovimentoBean.convidadoExiste}" update="id_valor_servico"/>
                                                </p:inputMask>
                                                <p:outputLabel value="Nascimento:" />
                                                <p:calendar value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.dtNascimento}" pattern="dd/MM/yyyy" size="10" id="iData" disabled="#{conviteMovimentoBean.desabilitaCampos}">
                                                    <p:ajax event="dateSelect" listener="#{conviteMovimentoBean.conviteMovimento.sisPessoa.selecionaDataNascimento}" />
                                                    <p:ajax event="change" listener="#{conviteMovimentoBean.convidadoExiste}" update="id_valor_servico"/>
                                                </p:calendar>
                                                <p:watermark value="99/99/9999" for="iData" />
                                            </h:panelGrid>
                                        </h:column>
                                        <p:outputLabel value="Convidado:" />
                                        <h:column>
                                            <h:panelGrid columns="2">
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.nome}" size="70" disabled="#{conviteMovimentoBean.desabilitaCampos}">
                                                    <p:ajax event="blur" listener="#{conviteMovimentoBean.convidadoExiste}" update="id_valor_servico"/>
                                                </p:inputText>
                                                <h:column rendered="#{conviteMovimentoBean.idadeConvidado != 0}">
                                                    <p:outputLabel value="Idade: #{conviteMovimentoBean.idadeConvidado} ano (s)" />
                                                </h:column>
                                            </h:panelGrid>
                                        </h:column>
                                        <p:outputLabel value="Sexo:" />
                                        <h:column>
                                            <h:panelGrid columns="3">
                                                <p:selectOneMenu value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.sexo}">
                                                    <f:selectItem itemValue="M" itemLabel="Masculino"/>
                                                    <f:selectItem itemValue="F" itemLabel="Feminino"/>
                                                </p:selectOneMenu>
                                                <p:outputLabel value="RG:" />
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.rg}" disabled="#{conviteMovimentoBean.desabilitaCampos}"/>
                                            </h:panelGrid>
                                        </h:column>
                                        <p:outputLabel value="Telefone:" />
                                        <h:column>
                                            <h:panelGrid columns="3">
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.telefone}" styleClass="ddd_telefone" />
                                                <p:outputLabel value="Celular:" />
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.celular}" styleClass="ddd_telefone" />
                                            </h:panelGrid>
                                        </h:column>
                                        <p:outputLabel value="Obs:" />
                                        <p:inputText value="#{conviteMovimentoBean.conviteMovimento.observacao}" size="80" />
                                    </h:panelGrid>
                                </p:panel>
                                <p:panel header="Endereço Convidado" styleClass="margin-top-max" id="i_panel_endereco_convidado">
                                    <h:panelGrid columns="2">
                                        <p:commandButton icon="ui-icon-search" title="Pesquisar Endereço" action="#{chamadaPaginaBean.pesquisaEndereco}" />
                                        <h:column>
                                            <p:outputLabel value="Pesquisar endereço" style="border-bottom: 1px dashed #888;" rendered="#{conviteMovimentoBean.conviteMovimento.sisPessoa.endereco.id == -1}"/>
                                        </h:column>
                                        <h:column></h:column>
                                        <p:outputLabel value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.endereco.enderecoToString}" />
                                        <p:outputLabel value="CEP:" />
                                        <p:outputLabel value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.endereco.cep}" />
                                        <p:outputLabel value="Número:" />
                                        <h:column>
                                            <h:panelGrid columns="3">
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.numero}" />
                                                <p:outputLabel value="Complemento:" />
                                                <p:inputText value="#{conviteMovimentoBean.conviteMovimento.sisPessoa.complemento}" />
                                            </h:panelGrid>
                                        </h:column>
                                    </h:panelGrid>
                                </p:panel>
                            </div>
                            <div style="float: left;">
                                <p:commandButton value="Capturar" update="i_panel_adicionar" onclick="PF('dgl_captura').show();"/>
                                <h:panelGrid columns="1" id="i_panel_imagens" styleClass="margin-top">
                                    <p:panel header="Perfil" id="i_panel_perfil">
                                        <h:column rendered="#{!conviteMovimentoBean.fotoTempPerfil.equals('')}" >
                                            <p:graphicImage value="#{conviteMovimentoBean.fotoTempPerfil}" id="i_perfil_temp" width="250"/>
                                            <div class="clear"></div>
                                            <p:commandButton icon="ui-icon-trash" title="Remover imagem"  action="#{conviteMovimentoBean.apagarImagem('perfil')}" />
                                        </h:column>
                                        <h:column rendered="#{!conviteMovimentoBean.fotoPerfil.equals('')}" >
                                            <p:graphicImage value="#{conviteMovimentoBean.fotoPerfil}" id="i_perfil" width="250"/>
                                            <div class="clear"></div>
                                            <p:commandButton icon="ui-icon-trash" title="Remover imagem" action="#{conviteMovimentoBean.apagarImagem('perfil')}" />
                                        </h:column>                                        
                                    </p:panel>
                                    <p:panel header="Documento" styleClass="margin-top" id="i_panel_documento">
                                        <h:column rendered="#{!conviteMovimentoBean.fotoTempArquivo.equals('')}" >
                                            <p:graphicImage value="#{conviteMovimentoBean.fotoTempArquivo}" id="i_documento_temp" width="250"/>
                                            <div class="clear"></div>
                                            <p:commandButton icon="ui-icon-trash" title="Remover documento" action="#{conviteMovimentoBean.apagarImagem('documento')}" />
                                        </h:column>
                                        <h:column rendered="#{!conviteMovimentoBean.fotoArquivo.equals('')}" >
                                            <p:graphicImage value="#{conviteMovimentoBean.fotoArquivo}" id="i_documento" width="250"/>
                                            <div class="clear"></div>
                                            <p:commandButton icon="ui-icon-trash" title="Remover documento" action="#{conviteMovimentoBean.apagarImagem('documento')}" />
                                        </h:column>
                                    </p:panel>
                                </h:panelGrid>
                            </div>
                            <div class="clear"></div>
                            <h:panelGrid columns="7">
                                <p:commandButton value="Salvar" onclick="PF('dgl_panel_salvar').show()" disabled="#{controleAcessoBean.botaoSalvar}" />
                                <p:commandButton value="Novo" action="#{conviteMovimentoBean.novo}" update="out_mensagem i_panel_adicionar id_lista"/>
                                <p:commandButton value="Excluir" onclick="PF('dgl_panel_excluir').show()"  disabled="#{controleAcessoBean.botaoExcluir}" />
                                <h:column rendered="#{conviteMovimentoBean.movimento.id != -1}">
                                    <h:column rendered="#{conviteMovimentoBean.desabilitaBaixa}">
                                        <h:commandLink action="#{imprimirConviteClube.imprimir(conviteMovimentoBean.conviteMovimento)}" target="_blank">
                                            <p:button icon="ui-icon-print"  value="Imprimir"></p:button>
                                        </h:commandLink>
                                    </h:column>
                                    <h:column rendered="#{!conviteMovimentoBean.desabilitaBaixa}">
                                        <p:commandButton value="Baixar" action="#{conviteMovimentoBean.baixarMovimento}" disabled="#{controleAcessoBean.botaoSalvar}" style="color: red;" ajax="false"/>
                                        <p:outputLabel value="Movimento não baixado" style="color: red;"/>
                                    </h:column>
                                </h:column>
                                <p:commandButton value="Sair" action="#{conviteMovimentoBean.close}" update="out_mensagem i_panel_adicionar id_lista"/>
                            </h:panelGrid>
                        </p:panel>
                    </p:dialog>
                    <p:dialog id="i_captura" widgetVar="dgl_captura" modal="true" header="Cadastro de Convite" resizable="true"  maximizable="true" minimizable="true">
                        <h:panelGrid id="i_panel_imagem" columns="1">
                            <p:photoCam widgetVar="pc" listener="#{conviteMovimentoBean.capturar}" update="i_panel_imagens"/>
                            <h:column>
                                <h:panelGrid columns="2">
                                    <p:commandButton type="button" value="Capturar Foto">
                                        <p:ajax event="click" listener="#{conviteMovimentoBean.capturarTipo('perfil')}" oncomplete="PF('pc').capture();"/>
                                    </p:commandButton>
                                    <p:commandButton type="button" value="Capturar Documento">
                                        <p:ajax event="click" listener="#{conviteMovimentoBean.capturarTipo('documento')}" oncomplete="PF('pc').capture();"/>
                                    </p:commandButton>
                                </h:panelGrid>
                            </h:column>
                        </h:panelGrid>                        
                    </p:dialog>
                    <p:dialog id="i_panel_salvar" widgetVar="dgl_panel_salvar" modal="true" header="Deseja salvar este registro?" width="300">
                        <center>
                            <h:panelGrid columns="2">
                                <p:commandButton value="Sim" title="Salvar" action="#{conviteMovimentoBean.save}" update="i_panel_adicionar, out_mensagem, :form_convite:id_lista" oncomplete="PF('dgl_panel_salvar').hide(); PF('dgl_panel_mensagem').show();"/>
                                <p:commandButton value="Não" title="Cancelar" onclick="PF('dgl_panel_salvar').hide();"/>
                            </h:panelGrid>
                        </center>
                    </p:dialog>
                    <p:dialog id="i_panel_excluir" widgetVar="dgl_panel_excluir"  modal="true" resizable="true" header="Deseja excluir este registro?" width="300">
                        <center>
                            <h:panelGrid columns="2">
                                <p:commandButton value="Sim" title="Excluir" action="#{conviteMovimentoBean.delete}" update="i_panel_adicionar, out_mensagem, :form_convite:id_lista" oncomplete="PF('dgl_panel_excluir').hide(); PF('dgl_panel_mensagem').show();"/>
                                <p:commandButton value="Não" title="Cancelar" onclick="PF('dgl_panel_excluir').hide();"/>
                            </h:panelGrid>
                        </center>
                    </p:dialog>                    
                    <p:dialog id="id_panel_mensagem" widgetVar="dgl_panel_mensagem" modal="true" header="Mensagem" width="300">
                        <center>
                            <h:panelGrid id="out_mensagem">
                                <p:outputLabel value="#{conviteMovimentoBean.message}" />                            
                            </h:panelGrid> 
                            <p:commandButton value="Ok" title="Ok" onclick="PF('dgl_panel_mensagem').hide();" />
                        </center>
                    </p:dialog>                    
                </h:form>                    
            </p:panel>                    
        </f:view>
    </h:body>
</ui:composition>